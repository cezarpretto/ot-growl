/**
 * ot-growl - v0.0.2 - 2015-10-30
 * 
 * Copyright (c) 2015 Marco Rinck,Jan Stevens,Silvan van Leeuwen,Cezar Pretto; Licensed MIT
 */
angular.module("ot-growl",[]),angular.module("ot-growl").directive("otGrowl",[function(){"use strict";return{restrict:"A",templateUrl:"templates/growl/growl.html",replace:!1,scope:{reference:"@",inline:"=",limitMessages:"="},controller:["$scope","$interval","otGrowl","growlMessages",function(a,b,c,d){a.referenceId=a.reference||0,d.initDirective(a.referenceId,a.limitMessages),a.growlMessages=d,a.inlineMessage=angular.isDefined(a.inline)?a.inline:c.inlineMessages(),a.$watch("limitMessages",function(b){var c=d.directives[a.referenceId];angular.isUndefined(b)||angular.isUndefined(c)||(c.limitMessages=b)}),a.stopTimeoutClose=function(a){a.clickToClose||angular.forEach(a.promises,function(a){b.cancel(a)})},a.alertClasses=function(a){return{"alert-success":"success"===a.severity,"alert-error":"error"===a.severity,"alert-danger":"error"===a.severity,"alert-info":"info"===a.severity,"alert-warning":"warning"===a.severity,icon:a.disableIcons===!1,"alert-dismissable":!a.disableCloseButton}},a.showCountDown=function(a){return!a.disableCountDown&&a.ttl>0},a.wrapperClasses=function(){var b={};return b["growl-fixed"]=!a.inlineMessage,b[c.position()]=!0,b},a.computeTitle=function(a){var b={success:"Success",error:"Error",info:"Information",warn:"Warning"};return b[a.severity]}}]}}]),angular.module("ot-growl").run(["$templateCache",function(a){"use strict";void 0===a.get("templates/growl/growl.html")&&a.put("templates/growl/growl.html",'<div class="growl-container" ng-class="wrapperClasses()"><div class="growl-item alert" ng-repeat="message in growlMessages.directives[referenceId].messages" ng-class="alertClasses(message)" ng-click="stopTimeoutClose(message)"><button type="button" class="close" data-dismiss="alert" aria-hidden="true" ng-click="growlMessages.deleteMessage(message)" ng-show="!message.disableCloseButton">&times;</button><button type="button" class="close" aria-hidden="true" ng-show="showCountDown(message)">{{message.countdown}}</button><h4 class="growl-title" ng-show="message.title" ng-bind="message.title"></h4><div class="growl-message" ng-bind-html="message.text"></div><div class="growl-detail-link" ng-if="message.details"><a href="" ng-click="message.showDetails = !message.showDetails">Ver mais detalhes</a></div><div class="growl-detail" ng-if="message.showDetails" ng-bind-html="message.details.detail"></div></div></div>')}]),angular.module("ot-growl").provider("otGrowl",function(){"use strict";var a={success:null,error:null,warning:null,info:null},b="messages",c="text",d="title",e="severity",f="ttl",g=!0,h="variables",i=0,j=!1,k="top-right",l=!1,m=!1,n=!1,o=!1,p=!0,q=0,r="",s=!0;this.globalTimeToLive=function(b){if("object"==typeof b)for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);else for(var d in a)a.hasOwnProperty(d)&&(a[d]=b);return this},this.globalTranslateMessages=function(a){return p=a,this},this.globalDisableCloseButton=function(a){return l=a,this},this.globalDisableIcons=function(a){return m=a,this},this.globalReversedOrder=function(a){return n=a,this},this.globalDisableCountDown=function(a){return o=a,this},this.messageVariableKey=function(a){return h=a,this},this.globalInlineMessages=function(a){return j=a,this},this.globalProjectId=function(a){return q=a,this},this.globalAccessToken=function(a){return r=a,this},this.globalInProduction=function(a){return s=a,this},this.globalPosition=function(a){return k=a,this},this.messagesKey=function(a){return b=a,this},this.messageTextKey=function(a){return c=a,this},this.messageTitleKey=function(a){return d=a,this},this.messageSeverityKey=function(a){return e=a,this},this.messageTTLKey=function(a){return f=a,this},this.onlyUniqueMessages=function(a){return g=a,this},this.serverMessagesInterceptor=["$q","growl",function(a,c){function d(a){void 0!==a&&a.data&&a.data[b]&&a.data[b].length>0&&c.addServerMessages(a.data[b])}return{response:function(a){return d(a),a},responseError:function(b){return d(b),a.reject(b)}}}],this.$get=["$rootScope","$interpolate","$sce","$filter","$interval","growlMessages",function(b,t,u,v,w,x){function y(a){if(K&&a.translateMessage)a.text=K(a.text,a.variables)||a.text,a.title=K(a.title)||a.title;else{var c=t(a.text);a.text=c(a.variables)}var d=x.addMessage(a);return b.$broadcast("growlMessage",a),w(function(){},0,1),d}function z(b,c,d,e){var f,g=c||{};return f={text:b,textCopy:angular.copy(b),title:g.title,severity:d,ttl:g.ttl||a[d],variables:g.variables||{},disableCloseButton:void 0===g.disableCloseButton?l:g.disableCloseButton,disableIcons:void 0===g.disableIcons?m:g.disableIcons,disableCountDown:void 0===g.disableCountDown?o:g.disableCountDown,position:g.position||k,referenceId:g.referenceId||i,translateMessage:void 0===g.translateMessage?p:g.translateMessage,destroy:function(){x.deleteMessage(f)},setText:function(a){f.text=u.trustAsHtml(String(a))},onclose:g.onclose,onopen:g.onopen,details:e,detailsCopy:angular.copy(e),showDetails:!1,projectId:q,accessToken:r,inProduction:s},y(f)}function A(a,b,c){return z(a,b,"warning",c)}function B(a,b,c){return z(a,b,"error",c)}function C(a,b,c){return z(a,b,"info",c)}function D(a,b,c){return z(a,b,"success",c)}function E(a,b,c){return c=(c||"error").toLowerCase(),z(a,b,c)}function F(a){if(a&&a.length){var b,g,i,j;for(j=a.length,b=0;j>b;b++)if(g=a[b],g[c]){i=(g[e]||"error").toLowerCase();var k={};k.variables=g[h]||{},k.title=g[d],g[f]&&(k.ttl=g[f]),z(g[c],k,i)}}}function G(){return g}function H(){return n}function I(){return j}function J(){return k}var K;x.onlyUnique=g,x.reverseOrder=n;try{K=v("translate")}catch(L){}return{warning:A,error:B,info:C,success:D,general:E,addServerMessages:F,onlyUnique:G,reverseOrder:H,inlineMessages:I,position:J}}]}),angular.module("ot-growl").service("growlMessages",["$sce","$interval","$http",function(a,b,c){"use strict";function d(a){var b;return b=g[a]?g[a]:g[a]={messages:[]}}function e(a){var b=a||0;return f.directives[b]||g[b]}var f=this;this.directives={};var g={};this.initDirective=function(a,b){return g[a]?(this.directives[a]=g[a],this.directives[a].limitMessages=b):this.directives[a]={messages:[],limitMessages:b},this.directives[a]},this.getAllMessages=function(a){a=a||0;var b;return b=e(a)?e(a).messages:[]},this.destroyAllMessages=function(a){for(var b=this.getAllMessages(a),c=b.length-1;c>=0;c--)b[c].destroy();var d=e(a);d&&(d.messages=[])},this.addMessage=function(c){var e,f,g,h;if(e=this.directives[c.referenceId]?this.directives[c.referenceId]:d(c.referenceId),f=e.messages,!this.onlyUnique||(angular.forEach(f,function(b){h=a.getTrustedHtml(b.text),c.text===h&&c.severity===b.severity&&c.title===b.title&&(g=!0)}),!g)){if(c.text=a.trustAsHtml(String(c.text)),void 0!==c.details&&(c.details.detail=a.trustAsHtml(String(c.details.detail))),c.ttl&&-1!==c.ttl&&(c.countdown=c.ttl/1e3,c.promises=[],c.close=!1,c.countdownFunction=function(){c.countdown>1?(c.countdown--,c.promises.push(b(c.countdownFunction,1e3,1,1))):c.countdown--}),angular.isDefined(e.limitMessages)){var i=f.length-(e.limitMessages-1);i>0&&f.splice(e.limitMessages-1,i)}if(this.reverseOrder?f.unshift(c):f.push(c),"function"==typeof c.onopen&&c.onopen(),c.ttl&&-1!==c.ttl){var j=this;c.promises.push(b(angular.bind(this,function(){j.deleteMessage(c)}),c.ttl,1,1)),c.promises.push(b(c.countdownFunction,1e3,1,1))}return c}},this.deleteMessage=function(a){var b=this.getAllMessages(a.referenceId),c=-1;for(var d in b)b.hasOwnProperty(d)&&(c=b[d]===a?d:c);c>-1&&(b[c].close=!0,b.splice(c,1)),"function"==typeof a.onclose&&a.onclose(),"error"===a.severity&&f.sendReport(a)},this.sendReport=function(a){if(a.inProduction&&""!==a.accessToken&&0!==a.projectId){console.log(a);var b={id:a.projectId,title:a.textCopy,description:a.detailsCopy.detail,labels:"REPORT AUTOMATICO"};c.post("https://gitlab.com/api/v3/projects/"+a.projectId+"/issues?private_token="+a.accessToken,b).success(function(){console.log("Report sent succesfuly!")}).error(function(a){console.error(a)})}}}]);